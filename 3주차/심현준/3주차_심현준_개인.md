# create  VS createStore ì°¨ì´ì  ë¶„ì„

# Introduction

**zustand ìƒíƒœê´€ë¦¬ ë°©ì‹ì„ ì´í•´í•œë‹¤ëŠ” ê²ƒì€ ë¬´ì—‡ì¼ê¹Œ? ì— ëŒ€í•œ ê³ ë¯¼** 

- â‡’ create ì™€ createStore í•¨ìˆ˜ ì°¨ì´ì ìœ¼ë¡œë¶€í„° ë¶„ì„í•´ë³´ê¸°

zustand ìƒíƒœê´€ë¦¬ë¥¼ ì´í•´í•˜ê¸° ìœ„í•´ì„œëŠ” ìš°ì„  ì•„ë˜ **ë„¤ ê°€ì§€ ê°œë…**ë“¤ì˜ ìœ ê¸°ì  ìƒê´€ê´€ê³„ë¥¼ ì´í•´í•˜ë©´ ë¨ 

1. **`createStore`**
2. **`create`**
3. **`useSyncExternalStore`**
4. **`useStore`** 

# Overview

- **ì „ì—­ìƒíƒœ(zustand):   ì „ì—­ìƒíƒœë¡œ ê´€ë¦¬í•  ì‚¬ìš©ìì •ì˜ initialState(State & Action) +** StoreApi **(** setState, getState, getInitialState, subscribe )**ë¥¼ ê°€ì§„ ê°ì²´**
    - ğŸ‘‰  "React ë Œë”ë§ ì‚¬ì´í´ê³¼ ë…ë¦½ì ìœ¼ë¡œ ì¡´ì¬. â€œ
    
- **createStore :  ì „ì—­ìƒíƒœ(ì‚¬ìš©ìì •ì˜ initialState + StoreAPI) ê°ì²´ë¥¼ ë§Œë“¤ì–´ì¤€ë‹¤.**
    - ğŸ‘‰Â â€ìƒíƒœ ê´€ë¦¬ë¥¼ ìœ„í•œ í•µì‹¬ APIì¸ StoreApi ****( setState, getState, getInitialState, subscribe )ë¥¼ ìƒì„±í•˜ê³ , ì´ë¥¼ ì‚¬ìš©ìê°€ ì •ì˜í•œ State ë° Action(ë©”ì„œë“œ)ì™€ ê²°í•©í•˜ì—¬
    ì™„ì „í•œ ì „ì—­ìƒíƒœ ê°ì²´ë¥¼ ë°˜í™˜â€
    
- **create  : ë‚´ë¶€ì ìœ¼ë¡œ ì „ì—­ìƒíƒœë¥¼ ë§Œë“¤ê³ , ê·¸ ì „ì—­ìƒíƒœë¥¼ êµ¬ë…ê°€ëŠ¥í•œ Hookê¹Œì§€ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜**
    - ğŸ‘‰  "createStoreë¥¼ í˜¸ì¶œí•˜ì—¬ ìŠ¤í† ì–´ë¥¼ ìƒì„±í•˜ê³ , ì´ë¥¼ ë‚´ë¶€ì ìœ¼ë¡œ useStore í›…ìœ¼ë¡œ ë˜í•‘í•˜ì—¬ í•´ë‹¹ Storeì— Bindëœ ìƒˆë¡œìš´ useStore Hook ë°˜í™˜â€
    - // useBoundStore(selector)
    
- **useSyncExternalStore :  ë¦¬ì•¡íŠ¸ ì‹œìŠ¤í…œ ì™¸ë¶€ì— ì¡´ì¬í•˜ëŠ” zustand ì „ì—­ìƒíƒœì™€ ë¦¬ì•¡íŠ¸ë¥¼ ì—°ê²°í•˜ëŠ” ê¸°ëŠ¥  (ì‹¤ì œ í”„ë¡œë•ì…˜ ì½”ë“œìƒì—ì„œ ì‚¬ìš©í•˜ê²Œ ë  ì¼ì€ ê±°ì˜ ì—†ìŒ, ì „ì—­ìƒíƒœ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë©”ì¸í…Œì´ë„ˆìš©)**

- useStore : ì „ì—­ìƒíƒœì—ì„œ ì‚¬ìš©ìì •ì˜ ìƒíƒœì˜ íŠ¹ì • ë¶€ë¶„( State / Action )ì„ selectí•˜ì—¬ ì‚¬ìš©
    - selector ë°˜í™˜ê°’ì„ [object.is](http://object.is) ë©”ì„œë“œë¡œ ê²€ì‚¬í•˜ì—¬ ë¦¬ë Œë”ë¥¼ ê²°ì • (ì „ì—­ìƒíƒœë¥¼ ê¸°ë³¸ì ìœ¼ë¡œ êµ¬ë…)
    - createì‚¬ìš©ì‹œì™€ ë‹¬ë¦¬ ëŒ€ìƒ targetì¸ Storeë¥¼ í•¨ê»˜ ì£¼ì…í•´ì£¼ì–´ì•¼í•¨.

## Deep Dive

### createStore

```tsx
export const createStore = (
(createState) => createState 
  ? createStoreImpl(createState)   // ì¼€ì´ìŠ¤ 1: ì§ì ‘ ì½œë°± ì „ë‹¬
  : createStoreImpl        // ì¼€ì´ìŠ¤ 2: createStoreImpl í•¨ìˆ˜ ë°˜í™˜
  ) as CreateStore
```

- ì½œë°±ì„ ë„£ê³  ë°”ë¡œ í˜¸ì¶œí• ì§€
    - createStore( callbackFn )  :  store
- ì½œë°±ì—†ì´ í˜¸ì¶œí•˜ê³  ê·¸ë‹¤ìŒ ì½œë°±ì„ ë„£ì–´ì„œ  í˜¸ì¶œí• ì§€
    - createStore()( callbackFn) : store
- ê²°êµ­ ë™ì¼í•œ `createStoreImpl(createState)` ê²°ê³¼ê°’ì„ ê°€ì§„ë‹¤.

### > createStoreImpl

```tsx
const createStoreImpl: CreateStoreImpl = (createState) => {
  type TState = ReturnType<typeof createState>
  type Listener = (state: TState, prevState: TState) => void
  **let state: TState  // 1**
  const listeners: Set<Listener> = new Set()

	// 2
  const setState: StoreApi<TState>['setState'] = (partial, replace) => {
    const nextState =
      typeof partial === 'function'
        ? (partial as (state: TState) => TState)(state)
        : partial
    if (!Object.is(nextState, state)) {
      const previousState = state
      state =
        (replace ?? (typeof nextState !== 'object' || nextState === null))
          ? (nextState as TState)
          : Object.assign({}, state, nextState)
      listeners.forEach((listener) => listener(state, previousState))
    }
  }
	// 3
  const getState: StoreApi<TState>['getState'] = () => state
	// 4
  const getInitialState: StoreApi<TState>['getInitialState'] = () =>
    initialState
	// 5
  const subscribe: StoreApi<TState>['subscribe'] = (listener) => {
    listeners.add(listener)
    // Unsubscribe
    return () => listeners.delete(listener)
  }
	// 6
  const api = { setState, getState, getInitialState, subscribe }
  // 7
  const initialState = (state = createState(setState, getState, api))
  return api as any
}
```

- TDZ ë¬¸ì œ(ì´ˆê¸°í™” ì „ ì ‘ê·¼)ëŠ” ê²°êµ­ ëŸ°íƒ€ì„ ì ‘ê·¼ ê°€ëŠ¥ ì œí•œ ì—¬ë¶€ì— ê´€í•œ ë¬¸ì œ
- getInitialStateí•¨ìˆ˜ì˜ í˜¸ì¶œì€ initialStateí•¨ìˆ˜ í˜¸ì¶œì´í›„ì— í˜¸ì¶œë˜ëŠ” êµ¬ì¡°ë¡œ ê°•ì œë˜ì–´ìˆìŒ.

### createStoreImpl ì—­í• 

- ì „ì—­ìƒíƒœë¥¼ ë§Œë“¤ì–´ì¤Œ
- ê·¸ëŸ°ë° ì‚¬ìš©ì ì •ì˜ ìƒíƒœì™€, zustandê°€ ì •ì˜í•˜ëŠ” Store APIë¥¼ ê³ë“¤ì¸ ,,
    - initialState + StoreAPI

### + ) createStoreë¥¼ ì‚¬ìš©í•˜ë©´ ì¢‹ì€ ê²½ìš°?

react ìƒíƒœê´€ë¦¬ ì‹œìŠ¤í…œ ë°”ê¹¥ì—ì„œ ì „ì—­ìŠ¤í† ì–´ë¥¼ ì´ˆê¸°í™”ì‹œì¼œì£¼ê³  ì‹¶ì€ ê²½ìš°

ex) ì„œë²„ì‚¬ì´ë“œë Œë”ë§ì‹œ, ì„œë²„ì—ì„œ fetchí•œ ë°ì´í„° ê¸°ë°˜ìœ¼ë¡œ initialStateë¥¼ ì´ˆê¸°í™”í•´ì£¼ê³ , ì´ë ‡ê²Œ ë§Œë“  Storeê°ì²´ë¥¼ Context Provider valueë¡œ ì œê³µí•˜ì—¬,  Context APIì™€ useStoreí›…ì„ í•¨ê»˜ ì‚¬ìš©í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì „ì—­ìƒíƒœë¥¼ ì œê³µ  

## create

```tsx

export const create = (<T>(createState: StateCreator<T, [], []> | undefined) =>
  createState ? createImpl(createState) : createImpl) as Create
```

- create(createState)
- create()(createState)

### createImpl

```tsx
const createImpl = <T>(createState: StateCreator<T, [], []>) => {
  const api = createStore(createState) // ì „ì—­ storeìƒì„±

  const useBoundStore: any = (selector?: any) => useStore(api, selector)

  Object.assign(useBoundStore, api)

  return useBoundStore
}
```

### useStore

```tsx

export function useStore<TState, StateSlice>(
  api: ReadonlyStoreApi<TState>, // ì „ì—­storeê°ì²´
  selector: (state: TState) => StateSlice = identity as any, // select
) {
  const slice = React.useSyncExternalStore( 
    api.subscribe,
    () => selector(api.getState()),
    () => selector(api.getInitialState()),
  )
  React.useDebugValue(slice)
  return slice
}

```

- createí•¨ìˆ˜ëŠ” ì¸ìê°’ìœ¼ë¡œ , createStateì½œë°±ì„ í•˜ë‚˜ ì „ë‹¬ë°›ìŒ
- createStateì½œë°±: í´ë¡œì €ë¡œ ì „ì—­ìƒíƒœì˜ setter,getterë“±ì˜ ë©”ì„œë“œë¥¼ ì „ë‹¬ë°›ê³ , ì´ë¥¼ í™œìš©í•´
initialStateë¡œ ì‚¬ìš©ì ì •ì˜ State & Actionì„ ì •ì˜í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì¤Œ
- createí•¨ìˆ˜ í˜¸ì¶œ ë°˜í™˜ê°’ì€ createStoreë¡œ ë§Œë“  Storeì— ë°”ì¸ë”©ëœ ìƒˆë¡œìš´ useStoreí›…ì„ ë°˜í™˜
    - í•´ë‹¹ hookì— selectorë§Œì„ ì œê³µí•˜ì—¬ ì‚¬ìš©ì ì •ì˜ ìƒíƒœë¥¼ ê°€ì ¸ì˜´

### ì „ì—­ìƒíƒœ

```tsx
ë¦¬ì•¡íŠ¸ ì• í”Œë¦¬ì¼€ì´ì…˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                         â”‚
â”‚   ì»´í¬ë„ŒíŠ¸ íŠ¸ë¦¬                             â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                 â†•                       â”‚
â”‚            ìƒíƒœ êµ¬ë…/ì‚¬ìš©                   â”‚
â”‚                 â†•                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€|â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†•
    ì™¸ë¶€ ì „ì—­ ìƒíƒœ ê´€ë¦¬ ì‹œìŠ¤í…œ 
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€|â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚   â”‚     ìƒíƒœ ë°ì´í„°         â”‚              â”‚
â”‚   â”‚  {                   â”‚              â”‚
â”‚   â”‚    user: User,       â”‚              â”‚
â”‚   â”‚    theme: string,    â”‚              â”‚
â”‚   â”‚    count: number     â”‚              â”‚
â”‚   â”‚  }                   â”‚              â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚            â†•                            â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚   â”‚     ì œì–´ APIë“¤        â”‚              â”‚
â”‚   â”‚  - setState()        â”‚              â”‚
â”‚   â”‚  - getState()        â”‚              â”‚
â”‚   â”‚  - subscribe()       â”‚              â”‚
â”‚   â”‚  - destroy()         â”‚              â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ê²°ë¡ 

- zustandì—ì„œ ë§Œë“œëŠ” ì „ì—­ìƒíƒœëŠ” ì‚¬ìš©ì ì •ì˜ stateì™€ StoreAPIë¥¼ ë³´ìœ í•œ Objectì´ë©°, ì´ëŠ” React ì• í”Œë¦¬ì¼€ì´ì…˜ ì™¸ë¶€ì— ì¡´ì¬í•œë‹¤.
- create ë°©ì‹ ì‚¬ìš©ì‹œ
    - ì „ì—­ìƒíƒœë¥¼ ìƒì„±í•œë‹¤.
    - useSyncExternalStoreê°€ ì´ ì „ì—­ìƒíƒœê°ì²´ì™€ Reactì‹œìŠ¤í…œì„ ì—°ê²°í•œë‹¤.
    - createí•¨ìˆ˜ ë°˜í™˜ê°’ì¸ Hookìœ¼ë¡œ ì „ì—­ìƒíƒœë¥¼ ì†Œë¹„í•œë‹¤.
- createStoreë¥¼ ì§ì ‘ ì‚¬ìš©í•˜ì—¬ Provider ë°©ì‹ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ë„ ìˆë‹¤.
- ì´ì œ Reactì—ì„œ ì „ì—­ìƒíƒœë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆë‹¤.
    
    

- createë¥¼ ì‚¬ìš©í•œë‹¤ë©´ Providerlessí•˜ê²Œ,
- creatreStoreë¥¼ ì§ì ‘ ì‚¬ìš©í•œë‹¤ë©´ Providerì™€ í•¨ê»˜

---