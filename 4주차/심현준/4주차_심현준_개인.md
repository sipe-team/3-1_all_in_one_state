# createReducer , createSlice ë™ì‘ ì›ë¦¬

### Redux ìƒíƒœê³„

-   **redux** : vanilla í™˜ê²½
-   **react-redux** : reduxë¥¼ reactì—ì„œ ì“¸ ìˆ˜ ìˆë„ë¡
    -   useSelector
    -   useDispatch
-   **@reduxjs/tookit** : redux + react-redux + redux-thunk + ë³´ì¼ëŸ¬í”Œë ˆì´íŠ¸ ê°œì„ 
    -   redux thunk : ê°„ë‹¨í•œ ì‚¬ì´ë“œì´í™íŠ¸ ì²˜ë¦¬ì— ì í•©í•œ middleware
    -   redux-saga : ë³µì¡í•œ ì‚¬ì´ë“œì´í™íŠ¸ ì²˜ë¦¬ middleware , generator ë¬¸ë²• ì‚¬ìš©

### reduxìƒíƒœê´€ë¦¬ íë¦„

-   View(UI Component)
    -   event Handlerì—ì„œ Dispatcher( action : UI event type) í˜¸ì¶œ
-   Middleware - ë¹„ë™ê¸°ì²˜ë¦¬, ë¡œê¹… , devTools ì²˜ë¦¬ ë“±
-   Reducer ( actionì— ë”°ë¥¸ ìƒˆë¡œìš´ ìƒíƒœë¥¼ ë°˜í™˜ )
-   Store ì ìš© , Viewì— ë°˜ì˜

![alt text](4week-shj-redux-process-image.png)

```tsx
// ì•¡ì…˜ íƒ€ì…
const INCREMENT = "counter/increment";
const DECREMENT = "counter/decrement";
const ADD_BY_AMOUNT = "counter/addByAmount";

// ì•¡ì…˜ ìƒì„±ì
const increment = () => ({ type: INCREMENT });
const decrement = () => ({ type: DECREMENT });
const addByAmount = amount => ({
	type: ADD_BY_AMOUNT,
	payload: amount,
});

// ë¦¬ë“€ì„œ
const counterReducer = (state = { value: 0 }, action) => {
	switch (action.type) {
		case INCREMENT:
			return { value: state.value + 1 };
		case DECREMENT:
			return { value: state.value - 1 };
		case ADD_BY_AMOUNT:
			return { value: state.value + action.payload };
		default:
			return state;
	}
};
```

1. ì•¡ì…˜ íƒ€ì… ë³€ìˆ˜ ì„ ì–¸
2. ì•¡ì…˜ ìƒì„±ì í•¨ìˆ˜
3. ê° ì•¡ì…˜ ì´ë²¤íŠ¸ì— ë”°ë¥¸ ìƒíƒœë¥¼ ë°˜í™˜í•  ë¦¬ë“€ì„œí•¨ìˆ˜ ì •ì˜
4. ì§ì ‘ì ì¸ ë¶ˆë³€ì„± ì²˜ë¦¬ë¥¼ í•„ìš”

## createReducer

```tsx
import { createReducer } from "@reduxjs/toolkit";

// ì•¡ì…˜ ìƒì„±ìëŠ” ì—¬ì „íˆ í•„ìš”
const increment = () => ({ type: "counter/increment" });
const decrement = () => ({ type: "counter/decrement" });

const counterReducer = createReducer({ value: 0 }, builder => {
	builder
		.addCase("counter/increment", state => {
			// immerë¥¼ í†µí•œ ì§ì ‘ ìˆ˜ì • ê°€ëŠ¥
			state.value += 1;
		})
		.addCase("counter/decrement", state => {
			state.value -= 1;
		})
		.addCase("counter/addByAmount", (state, action) => {
			state.value += action.payload;
		});
});
```

### createReducerëŠ” ë¬´ì—‡ì„ ê°œì„ í• ê¹Œ?

1. builderê°ì²´ ë¬¸ë²•ìœ¼ë¡œ action switch-caseë¬¸ ì œê±°
2. ë‚´ë¶€ì ìœ¼ë¡œ immerë¥¼ í™œìš©í•˜ì—¬, ë¶ˆë³€ì„± ì²˜ë¦¬ê°€ ê°„í¸í•´ì§

### íìŒ,,ğŸ¤”Â ê°œì„ ì´ë¼ì§€ë§Œ ë­”ê°€ ì•„ì‰½ë‹¤.

---

## createSlice

storeì— slice(ë…ë¦½ì ì¸ ìƒíƒœ ì¡°ê°)ë¥¼ ë§Œë“ ë‹¤.

1. slice nameì •ì˜
    1. ìƒíƒœë¥¼ ë‚˜ëˆˆ sliceì— nameì„ ë¶€ì—¬
2. initialStateì •ì˜
    1. sliceë³„ ì´ˆê¸° ìƒíƒœê°’
3. reducerì •ì˜
    1. sliceë³„ ì ìš©í•  actionì„ ëª…ì‹œ
    2. createReducerë¬¸ë²•ì„ ì ìš©ê°€ëŠ¥ , extraReducers(ì™¸ë¶€ ì•¡ì…˜ì´ë‚˜ ë¹„ë™ê¸° ì•¡ì…˜ì„ ì²˜ë¦¬) ì§€ì›

> createSlice â‡’ ì¶”í›„ sliceê°ì²´ë¥¼ ë§Œë“¤ì–´ì„œ actions, reducer í”„ë¡œí¼í‹°ë¥¼ ì¶”ì¶œí•˜ì—¬ storeë§Œë“¤ ë•Œ ì£¼ì…

```tsx
import { createSlice } from '@reduxjs/toolkit'
import type { PayloadAction } from '@reduxjs/toolkit'

interface CounterState {
  value: number
}

const initialState = { value: 0 } satisfies CounterState as CounterState

const counterSlice = createSlice({
  name: 'counter',
  initialState,
  reducers: {
    increment(state) {
      state.value++
    },
    decrement(state) {
      state.value--
    },
    incrementByAmount(state, action: PayloadAction<number>) {
      state.value += action.payload
    },
  },
})

**export const { increment, decrement, incrementByAmount } = counterSlice.actions
export default counterSlice.reducer**
```

### configureStoreì— reducerì— í• ë‹¹í•˜ì—¬ storeë¥¼ ìƒì„±

ê°œë³„ sliceì—ì„œ reducerë¥¼ ì¶”ì¶œí•˜ì—¬ í†µí•©ëœ rootReducer í˜•íƒœë¡œ storeì— ì£¼ì…

-   ë³µìˆ˜ì˜ reducerë„ í•˜ë‚˜ì˜ rootReducerë¡œ í†µí•©ëœë‹¤. why?
-   _ëª¨ë“  ì•¡ì…˜ì´ í•˜ë‚˜ì˜ íŒŒì´í”„ë¼ì¸ì„ í†µê³¼ //_ dispatch(action) -> rootReducer -> new state
-   ìƒíƒœê°„ ì˜ì¡´ì„±ì²˜ë¦¬

    ```tsx
    // postSlice.js
    const postSlice = createSlice({
    	name: "posts",
    	initialState: [],
    	reducers: {
    		addPost: (state, action) => {
    			state.push(action.payload);
    		},
    	},
    });

    // userSlice.js
    const userSlice = createSlice({
    	name: "users",
    	initialState: {
    		list: [],
    		postCounts: {},
    	},
    	reducers: {},
    	extraReducers: builder => {
    		builder.addCase(postSlice.actions.addPost, (state, action) => {
    			// ì‚¬ìš©ìê°€ í¬ìŠ¤íŠ¸ë¥¼ ì‘ì„±í•  ë•Œë§ˆë‹¤ ì¹´ìš´íŠ¸ ì¦ê°€
    			const userId = action.payload.userId;
    			state.postCounts[userId] = (state.postCounts[userId] || 0) + 1;
    		});
    	},
    });
    ```

<img src="ReduxAsyncDataFlowDiagram-d97ff38a0f4da0f327163170ccc13e80.gif" width="800" height="600" alt="Redux Async Data Flow">

[Redux í•µì‹¬, Part 5: Async Logic and Data Fetching | Redux](https://ko.redux.js.org/tutorials/essentials/part-5-async-logic/)

### createSliceë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ ë‹¤ìŒê³¼ ê°™ì€ ë³´ì¼ëŸ¬í”Œë ˆì´íŠ¸ ì½”ë“œë“¤ì´ í•„ìš”í•¨

-   ì•¡ì…˜ íƒ€ì… ì •ì˜
    ```tsx
    // createSlice ì‚¬ìš© ì‹œì—ëŠ” ìë™ ìƒì„±ë˜ëŠ” ë¶€ë¶„
    const ADD_TODO = "todos/ADD_TODO";
    ```
-   ì•¡ì…˜ ìƒì„±ìí•¨ìˆ˜ ì •ì˜

    ```tsx
    // createSlice ì‚¬ìš© ì‹œì—ëŠ” ìë™ ìƒì„±ë˜ëŠ” ë¶€ë¶„
    interface Todo {
      id: number
      text: string
      completed: boolean
    }

    interface AddTodoAction {
      type: typeof ADD_TODO
      payload: Todo
    }

    ~~// ì•¡ì…˜ ìƒì„±ì í•¨ìˆ˜
    const addTodo = (todo: Todo): AddTodoAction => ({
      type: ADD_TODO,
      payload: todo
    })~~
    ```

-   ë¦¬ë“€ì„œí•¨ìˆ˜ ì •ì˜

### ê°œì„ ë°©í–¥

> ì¼ë°˜ reducerìƒì„±, ë³´ì¼ëŸ¬ í”Œë ˆì´íŠ¸ ì½”ë“œ
> â†’ createReducerë¡œ ì•½ê°„ ê°„ì†Œí™”
> â†’ createSliceë¡œ í•œë²ˆì— ì²˜ë¦¬

-   createReducer:
    -   Immer ì§€ì› âœ…
    -   ì•¡ì…˜ ìë™ ìƒì„± âŒ
    -   builder íŒ¨í„´ âœ…
    -   ë§¤ì²˜ ì§€ì› âœ…
-   createSlice:
    -   Immer ì§€ì› âœ…
    -   ì•¡ì…˜ ìë™ ìƒì„± âœ…
    -   builder íŒ¨í„´ âœ… (extraReducers)
    -   ë§¤ì²˜ ì§€ì› âœ…
-   ì¼ë°˜ ë¦¬ë“€ì„œ:
    -   Immer ì§€ì› âŒ
    -   ì•¡ì…˜ ìë™ ìƒì„± âŒ
    -   builder íŒ¨í„´ âŒ
    -   ë§¤ì²˜ ì§€ì› âŒ
