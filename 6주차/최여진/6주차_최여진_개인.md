# Recoil ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë¬¸ì œ íŒŒí—¤ì¹˜ê¸°

## ğŸŒŸ ë“¤ì–´ê°€ë©°
Recoil ì„ ì°¾ì•„ë³´ë©´ì„œ [Recoil, ì´ì œëŠ” ë– ë‚˜ ë³´ë‚¼ ì‹œê°„ì´ë‹¤ ](https://medium.com/@clockclcok/recoil-%EC%9D%B4%EC%A0%9C%EB%8A%94-%EB%96%A0%EB%82%98-%EB%B3%B4%EB%82%BC-%EC%8B%9C%EA%B0%84%EC%9D%B4%EB%8B%A4-ff2c8674cdd5)  ë¼ëŠ” ê¸€ì„ ë³´ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.
ì±„ìš© ê³µê³ ë¥¼ ë³´ë©´ ì•„ì§ Recoil ì„ ì“°ëŠ” ê³³ì´ ë§ì€ë°, ì´ ê¸€ì—ì„œ ì§€ì í•˜ëŠ” Recoil ì˜ ë‹¨ì ì´ í¥ë¯¸ë¡œì› ìŠµë‹ˆë‹¤.

ìœ„ ê¸€ì—ì„œ ì–¸ê¸‰í•˜ëŠ” Recoil ì˜ ë‹¨ì ì€
1) ìœ ì§€ ë³´ìˆ˜ ë¬¸ì œ
	- Meta(Facebook) ì˜ ì§€ì›ì´ ë¶€ì¡±í•˜ë©° ë§ˆì§€ë§‰ ë©”ì´ì € ì—…ë°ì´íŠ¸ (0.7.7) ì´ 2023ë…„ 4ì›” ì´í›„ ì—†ë‹¤ + ì•„ì§ v1.x ë„ ë‚˜ì˜¤ì§€ ì•Šì•˜ë‹¤ (cf. zustand ëŠ” v5.0.1 ì´ 10ì›” 30ì¼, jotai ëŠ” v2.10.3 ì´ 2ì£¼ ì „)
	- ë§ì€ APIë“¤ì´ ì—¬ì „íˆ 'unstable_' ì ‘ë‘ì‚¬ë¥¼ ë‹¬ê³  ìˆë‹¤
	- ë©”ì¸í…Œì´ë„ˆê°€ í˜ì´ìŠ¤ë¶ì—ì„œ í‡´ì‚¬í•˜ì˜€ë‹¤..
1) ê¸°ìˆ ì ì¸ ë¬¸ì œ
	- atomFamily ì™€ ê´€ë ¨ëœ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë¬¸ì œ
	- ë¹„ë™ê¸° selector ì˜ ìºì‹œ ê´€ë¦¬ ì´ìŠˆ
	- TypeScript ì§€ì›ì´ ë¯¸í¡
	- SSR ì§€ì›ì´ ë¶ˆì•ˆì •
2) êµ¬ì¡°ì  í•œê³„
	- ë³µì¡í•œ ë¹„ë™ê¸° ë¡œì§ ì²˜ë¦¬
	- ì „ì—­ ìƒíƒœì™€ ë¡œì»¬ ìƒíƒœì˜ êµ¬ë¶„ì´ ëª¨í˜¸í•˜ë‹¤
	- atomic í•œ ìƒíƒœ ê´€ë¦¬ê°€ ì˜¤íˆë ¤ ë³µì¡ì„±ì„ ì¦ê°€ì‹œí‚¬ ìˆ˜ ìˆë‹¤

ë“±ì´ ìˆì—ˆìŠµë‹ˆë‹¤.

 íŠ¹íˆ Recoil GitHubì—ì„œ `atomFamily`/`selectorFamily` ê´€ë ¨ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ [ì´ìŠˆ](https://github.com/facebookexperimental/Recoil/issues/366)ë¥¼ ë°œê²¬í•˜ê³ , ì´ ë¬¸ì œë¥¼ ìì„¸íˆ íŒŒì•…í•´ë³´ê³  ì‹¶ì—ˆìŠµë‹ˆë‹¤.

##  atomFamily ë¥¼ ì‚¬ìš©í•  ë•Œ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ í™•ì¸í•˜ê¸°

> `atomFamily`ëŠ” ë§¤ê°œë³€ìˆ˜ë¥¼ ê¸°ë°˜ìœ¼ë¡œ atomì„ ë™ì ìœ¼ë¡œ ìƒì„±í•˜ëŠ” Recoilì˜ ê¸°ëŠ¥ì…ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ì‚¬ìš©ì IDë¥¼ ë§¤ê°œë³€ìˆ˜ë¡œ ë°›ì•„ ê°Â ì‚¬ìš©ìë³„ë¡œ ë…ë¦½ì ì¸ ìƒíƒœë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ì‹¤í—˜ ê°œìš”
- í™”ë©´ì— ìƒˆë¡œìš´ ì‚¬ìš©ìë¥¼ ìƒì„±í•˜ëŠ” "Add User", "Remove All User" ë‘ ê°œì˜Â ë²„íŠ¼ì´ ìˆìŠµë‹ˆë‹¤.
- ê° ì‚¬ìš©ìëŠ” ê³ ìœ í•œ ID ë¥¼ ê°€ì§€ê³  ì´ ID ë¥¼ ê¸°ë°˜ìœ¼ë¡œ atomFamily ê°€ ìƒˆë¡œìš´ atom ì„ ìƒì„±í•©ë‹ˆë‹¤
- ê° ì‚¬ìš©ì ë°ì´í„°ëŠ” ì˜ë„ì ìœ¼ë¡œ í° ë©”ëª¨ë¦¬(1000,0000ê°œì˜ ë¬¸ìì—´ì„ ê°€ì§„ ë°°ì—´) ì‚¬ìš©í•˜ë„ë¡ í•©ë‹ˆë‹¤

### ì‹¤í—˜ ë°©ë²•
1. ChromeÂ DevToolsì˜ Memory íƒ­ í™œìš©
2. ì´ˆê¸° ìƒíƒœì˜ heapÂ snapshot ìƒì„±Â (Snapshot 1)
3. "Add User" ë²„íŠ¼ì„ 50íšŒÂ í´ë¦­í•˜ì—¬ ì‚¬ìš©ì ì¶”ê°€
4. ë‘ ë²ˆì§¸ heapÂ snapshot ìƒì„± (SnapshotÂ 2)
5. "Remove All User" ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ì‚¬ìš©ì ëª¨ë‘ ì œê±°
6. ì„¸Â ë²ˆì§¸ heap snapshot ìƒì„±Â (Snapshot 3)
7. Snapshots ë¹„êµÂ ë¶„ì„
	-  Snapshot 1ê³¼ 2ë¥¼Â ë¹„êµí•˜ì—¬ ë©”ëª¨ë¦¬ ì¦ê°€ëŸ‰Â í™•ì¸
	-  SnapshotÂ 2ì™€ 3ì„ ë¹„êµí•˜ì—¬Â ë©”ëª¨ë¦¬ í•´ì œ ì—¬ë¶€Â í™•ì¸

### ì‹¤í—˜ìš© ì½”ë“œ êµ¬í˜„
ë¨¼ì €, atomFamilyë¥¼ ì‚¬ìš©í•˜ì—¬ í° ë©”ëª¨ë¦¬ë¥¼ ê°€ì§„ ì‚¬ìš©ì ìƒíƒœë¥¼ ê´€ë¦¬í•˜ëŠ” ì½”ë“œë¥¼ êµ¬í˜„í•˜ì˜€ìŠµë‹ˆë‹¤.
```tsx
// userState.ts
import { atomFamily } from 'recoil';

const createLargeData = (userId: string) => {
  return {
    id: userId,
    name: `User ${userId}`,
    // ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì„ í™•ì¸í•˜ê¸° ìœ„í•œ í° ë°ì´í„°
    largeData: new Array(100000).fill(`Large data for user ${userId}`)
  };
};

// userIdë¥¼ ë§¤ê°œë³€ìˆ˜ë¡œ ë°›ì•„ ìƒˆë¡œìš´ atomì„ ìƒì„±
export const userStateFamily = atomFamily({
  key: 'userState',
  default: (userId: string) => createLargeData(userId)
});
```

ë‹¤ìŒìœ¼ë¡œ, ì‚¬ìš©ìì˜ ì •ë³´ë¥¼ í‘œì‹œí•˜ëŠ”Â ì»´í¬ë„ŒíŠ¸ë¥¼ êµ¬í˜„í•˜ì˜€ìŠµë‹ˆë‹¤. ì´ ì»´í¬ë„ŒíŠ¸ëŠ”Â `atomFamily`ë¡œë¶€í„° í•´ë‹¹ ì‚¬ìš©ìì˜ ìƒíƒœë¥¼Â êµ¬ë…í•˜ê³  ë Œë”ë§í•©ë‹ˆë‹¤.

```tsx
// UserComponent.tsx
import React from 'react';
import { useRecoilState } from 'recoil';
import { userStateFamily } from '../atoms/userState';

export function UserComponent({ userId }: { userId: string }) {
  // userStateFamilyë¥¼ í†µí•´ í•´ë‹¹ userIdì— ëŒ€í•œ atomì„ êµ¬ë…
  const [userState] = useRecoilState(userStateFamily(userId));

  return (
    <div style={{ border: '1px solid #ccc', padding: '10px', margin: '5px' }}>
      <h4>User {userId}</h4>
      <p>Name: {userState.name}</p>
    </div>
  );
}
```

ë§ˆì§€ë§‰ìœ¼ë¡œ, `App` ì—ì„œëŠ” ì‚¬ìš©ìë¥¼ ì¶”ê°€í•˜ê³ Â ì œê±°í• Â ìˆ˜ ìˆë„ë¡ ë²„íŠ¼ì„ ì¶”ê°€í•˜ì˜€ìŠµë‹ˆë‹¤.

```tsx
function AppContent() {
  // í˜„ì¬ í‘œì‹œì¤‘ì¸ ì‚¬ìš©ì ID ëª©ë¡
  const [userIds, setUserIds] = useState<string[]>([]);
  // ìƒˆë¡œìš´ ì‚¬ìš©ì IDë¥¼ ìƒì„±í•˜ê¸° ìœ„í•œ ì¹´ìš´í„°
  const [counter, setCounter] = useState(0);

  const addUser = () => {
    const newUserId = counter.toString();
    setUserIds(prev => [...prev, newUserId]);
    setCounter(c => c + 1);
  };

  const removeUser = () => {
    setUserIds([]);
  };

  return (
    <div style={{ padding: '20px' }}>
      <div style={{ marginBottom: '20px' }}>
        <button onClick={addUser}>Add User</button>
        <button onClick={removeUser} style={{ marginLeft: '10px' }}>Remove All User</button>
      </div>
      <p>Active Users: {userIds.length}</p>
      <div style={{ display: 'flex', flexWrap: 'wrap' }}>
        {userIds.map(userId => (
          <UserComponent key={userId} userId={userId} />
        ))}
      </div>
    </div>
  );
}
```

ì´ë ‡ê²Œ ìˆ˜ì •ëœ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œëŠ” ì‚¬ìš©ìë¥¼Â ì¶”ê°€í•  ë•Œë§ˆë‹¤ ìƒˆë¡œìš´ atomì´ ìƒì„±ë˜ê³ , "Remove All Users" ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ ëª¨ë“  ì»´í¬ë„ŒíŠ¸ê°€ í•œÂ ë²ˆì— ì œê±°ë©ë‹ˆë‹¤.

![alt text](image-1.png)

### ì‹¤í—˜ ê²°ê³¼

|ë‹¨ê³„|Heap í¬ê¸°|ë©”ëª¨ë¦¬ ë³€í™” ì„¤ëª…|
|------|-----------|------------------|
| ì´ˆê¸°Â ìƒíƒœ | 3.5 MB| ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘ ì‹œ ê¸°ë³¸ ë©”ëª¨ë¦¬Â ì‚¬ìš©Â |
| 100ëª…ì˜ ì‚¬ìš©ìÂ ì¶”ê°€ í›„ | 45.7 MBÂ | ê° ì‚¬ìš©ìÂ ì¶”ê°€ ì‹œ ì•½ 0.5 MBÂ ì¦ê°€ |
| ì „ì²´Â ì‚¬ìš©ì ì œê±° í›„Â | 44.8 MB | ìˆ˜ë™ìœ¼ë¡œ ê°€ë¹„ì§€ ì»¬ë ‰í„° ë™ì‘ì‹œì¼œë„ ë©”ëª¨ë¦¬ í•´ì œ ë¯¸ë¯¸Â |

ì´ˆê¸° ìƒíƒœ(3.5MB)ì—ì„œ 100ëª…ì˜ ì‚¬ìš©ìë¥¼ ì¶”ê°€í•œ í›„ 45.7MBë¡œ ë©”ëª¨ë¦¬ê°€ ì¦ê°€ í•œ í›„ì—
ì‚¬ìš©ìë¥¼ ëª¨ë‘ ì œê±°í•˜ì—¬ë„ 44.8MBë¡œ ê±°ì˜ ê°ì†Œí•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.

ì´ëŠ” `atomFamily`ë¡œ ìƒì„±ëœ ìƒíƒœê°€ ì»´í¬ë„ŒíŠ¸ ì œê±° í›„ì—ë„ ë©”ëª¨ë¦¬ì—ì„œ ì ì ˆíˆ í•´ì œë˜ì§€ ì•Šê³  ìˆìŒì„ ë³´ì—¬ì¤ë‹ˆë‹¤.



![alt text](image.png)

ì‚¬ìš©ìë¥¼ ëª¨ë‘ ì œê±°í•œ í›„ì˜ Memory Snapshot ì„ í™•ì¸í•´ë³´ë©´ {id, name, largeData} x101 ì´ë¼ëŠ” í•­ëª©ì´ ìˆìŠµë‹ˆë‹¤.
```
{id, name, largeData} x101
- Shallow Size: 2,424 bytes (0%)
- Retained Size: 40,008,824 bytes (89%)
```

ê° ê°ì²´ê°€ ì°¸ì¡°í•˜ê³  ìˆëŠ” largeData ë°°ì—´ì„ í¬í•¨í•œ ì „ì²´ ë©”ëª¨ë¦¬ í¬ê¸°ëŠ” 40,008,824 bytes ë¡œ ì•½ 40MB ì…ë‹ˆë‹¤.
ì´ëŠ” ì „ì²´ ë©”ëª¨ë¦¬ì˜ ì•½ 90%ë¥¼ ì°¨ì§€í•˜ê³  ìˆìŠµë‹ˆë‹¤.

`defaultLodable` , `getAtom()` ê´€ë ¨ ì½”ë“œë¡œ ë³´ì•„ Recoil ë‚´ë¶€ ì°¸ì¡°ë¡œ ì¸í•´ ê°€ë¹„ì§€ ì»¬ë ‰í„°ê°€ ë©”ëª¨ë¦¬ë¥¼ íšŒìˆ˜í•˜ì§€ ëª»í•˜ëŠ” ê²ƒìœ¼ë¡œ ë³´ì…ë‹ˆë‹¤.

ë˜í•œ Chrome Performance íƒ­ì—ì„œë„ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ í˜„ìƒì„ í™•ì¸í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

![alt text](image-2.png)

ì‚¬ìš©ìë¥¼ ì¶”ê°€í•˜ë©´ì„œ JS Heap ë©”ëª¨ë¦¬ê°€ ì¦ê°€í•˜ê³ , ì‚¬ìš©ìë¥¼ ëª¨ë‘ ì œê±°í•œ í›„ì— ë…¸ë“œëŠ” ì œê±°ë˜ì§€ë§Œ ë©”ëª¨ë¦¬ëŠ” í•´ì œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.

ì´ëŠ” ì‚¬ìš©ì ë°ì´í„°ë¥¼ ëª¨ë‘ ì œê±°í–ˆìŒì—ë„ ë¶ˆêµ¬í•˜ê³  ëª¨ë‘ ë©”ëª¨ë¦¬ì— ë‚¨ì•„ìˆì–´ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ê°€ ë°œìƒí•˜ê³  ìˆìŒì„ ë³´ì—¬ì¤ë‹ˆë‹¤.

## ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ê°€ ì™œ ì¼ì–´ë‚ ê¹Œ
Recoil ì˜ ë‚´ë¶€ êµ¬í˜„ì„ ì‚´í´ë³´ë©´ì„œ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ê°€ ì™œ ì¼ì–´ë‚˜ëŠ”ì§€ ì•Œì•„ë³´ì•˜ìŠµë‹ˆë‹¤.

### 1. atomFamilyì˜ ë™ì‘ ë°©ì‹
`atomFamily`ëŠ” íŒŒë¼ë¯¸í„°ë§ˆë‹¤ ìƒˆë¡œìš´ atomì„ ìƒì„±í•˜ê³  ìºì‹œí•˜ëŠ” íŒ©í† ë¦¬ í•¨ìˆ˜ì…ë‹ˆë‹¤.
```js
function atomFamily(options) {
  const atomCache = cacheFromPolicy({
    equality: options.cachePolicyForParams_UNSTABLE?.equality ?? 'value',
    eviction: 'keep-all'
  });

  return (params) => {
    const cachedAtom = atomCache.get(params);
    if (cachedAtom != null) {
      return cachedAtom;
    }

    // ìƒˆë¡œìš´ atom ìƒì„±
    const newAtom = atom({
      ...atomOptions,
      key: `${options.key}__${stableStringify(params)}`,
      retainedBy_UNSTABLE:
        typeof options.retainedBy_UNSTABLE === 'function'
          ? options.retainedBy_UNSTABLE(params)
          : options.retainedBy_UNSTABLE,
    });

    atomCache.set(params, newAtom);
    return newAtom;
  };
}
```
### 2. atom ì˜ ê¸°ë³¸ RetainedBy ì„¤ì •
Recoilì˜ atomì€ ìƒì„±ë  ë•Œ `retainedBy` ì˜µì…˜ì„ ì§€ì •í•˜ì§€ ì•Šìœ¼ë©´ ê¸°ë³¸ê°’ìœ¼ë¡œ `recoilRoot`ê°€ ì„¤ì •ë©ë‹ˆë‹¤.

```ts
// Recoil_Retention.js
function retainedByOptionWithDefault(r: RetainedBy | void): RetainedBy {
  return r === undefined ? 'recoilRoot' : r;
}

// Recoil_atom.js
function baseAtom<T>(options: BaseAtomOptions<T>): RecoilState<T> {
  const retainedBy = retainedByOptionWithDefault(options.retainedBy_UNSTABLE);
  // ...
}
```

### 2. release ë¶ˆê°€ëŠ¥í•œ ë…¸ë“œ íŒë³„
Recoilì€ ë…¸ë“œê°€ release ê°€ëŠ¥í•œì§€ë¥¼ íŒë‹¨í•  ë•Œ, `retainedBy` ê°’ì´ `recoilRoot`ì¸ ë…¸ë“œëŠ” releaseí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
```tsx
// Recoil_Retention.js
function findReleasableNodes(store, searchFromNodes) {
  // ...
  for (const node of downstreams) {
    // Not releasable if configured to be retained forever:
    if (getNode(node).retainedBy === 'recoilRoot') {
      nonReleasableNodes.add(node);
      continue;
    }
    // ...
  }
}
```
### 3. RecoilRoot ì–¸ë§ˆìš´íŠ¸ ì‹œì—ë§Œ ì •ë¦¬

ê²Œë‹¤ê°€ ë…¸ë“œì˜ cleanupì€ RecoilRootê°€ ì–¸ë§ˆìš´íŠ¸ë  ë•Œë§Œ ì‹¤í–‰ë©ë‹ˆë‹¤.

```tsx
// Recoil_RecoilRoot.js
useEffect(() => {
  const store = storeRef.current;
  // ...
  return () => {
    for (const atomKey of store.getState().knownAtoms) {
      cleanUpNode(store, atomKey);
    }
  };
}, []);
```

Recoil íŒ€ë„ ì´ ë¬¸ì œë¥¼ ì¸ì‹í•˜ê³  ìˆì–´ì„œ, `The default will change from 'recoilRoot' to 'components' in the future.` ë¼ëŠ” ì£¼ì„ì´ ì¡´ì¬í•©ë‹ˆë‹¤. ë¯¸ë˜ì—ëŠ”(..?) ê¸°ë³¸ê°’ì„ 'components'ë¡œ ë³€ê²½í•  ê³„íšì´ë¼ê³  í•©ë‹ˆë‹¤.

## í•´ê²° ë°©ë²•
github ì´ìŠˆì—ì„œ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ì§ì ‘ ì»¤ìŠ¤í…€ ê°€ë¹„ì§€ ì»¬ë ‰í„°ë¥¼ êµ¬í˜„í•˜ëŠ” ë°©ë²•ì„ ì°¾ì„ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

```tsx
export const RECOIL_GARBAGE_COLLECTOR_UNSTABLE = ({
  shouldCheckForGarbageCollection,  // ì–´ë–¤ ë…¸ë“œë¥¼ ê²€ì‚¬í• ì§€ ê²°ì •í•˜ëŠ” í•¨ìˆ˜
  interval                         // ì²´í¬ ì£¼ê¸°(ë°€ë¦¬ì´ˆ)
}) => {
  // í˜„ì¬ Recoil storeì— ëŒ€í•œ ì°¸ì¡°ë¥¼ ê°€ì ¸ì˜´
  const storeRef = useStoreRef()
  // ë…¸ë“œì˜ êµ¬ë… ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” hook
  const getRecoilValueInfo = useGetRecoilValueInfo_UNSTABLE()

  // ë¯¸ì‚¬ìš© ë…¸ë“œ ì •ë¦¬í•˜ëŠ” ì½œë°± í•¨ìˆ˜
  const releaseUnusedNodes = useRecoilCallback(
    ({ snapshot }) => () => {
      // storeê°€ ì—†ìœ¼ë©´ ì¢…ë£Œ
      if (storeRef.current === null) return

      // í˜„ì¬ ìƒíƒœì˜ ìŠ¤ëƒ…ìƒ·ì„ ìœ ì§€
      const releaseSnapshot = snapshot.retain()
      const state = storeRef.current.getState()

      // ëª¨ë“  ë…¸ë“œë¥¼ ìˆœíšŒ
      for (const node of snapshot.getNodes_UNSTABLE()) {
        // knownAtomsë‚˜ knownSelectorsì— ì—†ëŠ” ë…¸ë“œëŠ” ìŠ¤í‚µ
        if (!state.knownAtoms.has(node.key) && !state.knownSelectors.has(node.key)) {
          continue
        }

        // ê²€ì‚¬ ëŒ€ìƒì¸ ë…¸ë“œë§Œ ì²˜ë¦¬
        if (props.shouldCheckForGarbageCollection(node.key)) {
          // ë…¸ë“œ ë ˆë²¨ì˜ ì²« ë²ˆì§¸ êµ¬ë…ì í™•ì¸
          const firstNodeSubscriber = snapshot
            .getInfo_UNSTABLE(node)
            .subscribers
            .nodes[Symbol.iterator]()
            .next()

          // ì»´í¬ë„ŒíŠ¸ ë ˆë²¨ì˜ ì²« ë²ˆì§¸ êµ¬ë…ì í™•ì¸
          const firstComponentSubscriber = getRecoilValueInfo(node)
            .subscribers
            .components[Symbol.iterator]()
            .next()

          // êµ¬ë…ìê°€ í•˜ë‚˜ë„ ì—†ëŠ”ì§€ í™•ì¸
          const hasNoSubscriber =
            firstNodeSubscriber.done &&
            firstNodeSubscriber.value === undefined &&
            firstComponentSubscriber.done &&
            firstComponentSubscriber.value === undefined

          // êµ¬ë…ìê°€ ì—†ìœ¼ë©´ ë…¸ë“œ ì •ë¦¬
          if (hasNoSubscriber) {
            releaseNode(storeRef.current, state.currentTree, node.key)
          }
        }
      }

      // ìŠ¤ëƒ…ìƒ· í•´ì œ
      releaseSnapshot()
    },
    [getRecoilValueInfo, props, storeRef]
  )

  // interval ë§ˆë‹¤ ì •ë¦¬ ì‘ì—… ì‹¤í–‰
  useEffect(() => {
    const interval = setInterval(releaseUnusedNodes, props.interval)
    return () => clearInterval(interval)  // cleanup
  }, [props.interval, releaseUnusedNodes])

  return null
}
```

ìš”ì•½í•˜ìë©´, Recoilì˜ `useStoreRef` ë¥¼ ë‚´ë³´ë‚´ë„ë¡ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ìˆ˜ì •í•˜ê³   `useGetRecoilValueInfo_UNSTABLE`ì„ í™œìš©í•´ì„œ ì„¤ì •í•œ ì£¼ê¸°(ex.5ì´ˆ)ë§ˆë‹¤ ëª¨ë“  Recoil ë…¸ë“œë¥¼ ê²€ì‚¬í•˜ì—¬ êµ¬ë…ì¤‘ ìƒíƒœê°€ ì—†ëŠ” ë…¸ë“œë¥¼ ì°¾ì•„ëƒ…ë‹ˆë‹¤. ì´ë ‡ê²Œ ì°¾ì€ ë¯¸ì‚¬ìš© ë…¸ë“œë“¤ì„ Recoil ì €ì¥ì†Œì—ì„œ í•´ë‹¹ ë…¸ë“œì˜ ì°¸ì¡° ìì²´ë¥¼ ì œê±°í•´ì„œ ë©”ëª¨ë¦¬ì—ì„œ ì •ë¦¬í•¨ìœ¼ë¡œì¨ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ë¥¼ ë°©ì§€í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ êµ¬í˜„í•©ë‹ˆë‹¤.
# ê²°ë¡ 
ì´ë²ˆ ë¶„ì„ì„ í†µí•´ Recoilì˜ atomFamilyê°€ ê°€ì§„ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë¬¸ì œë¥¼ ì§ì ‘ í™•ì¸í•˜ê³  ì½”ë“œë¥¼ ë³´ë©´ì„œ ì›ì¸ì„ íŒŒì•…í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. `retainedBy`ì˜ ê¸°ë³¸ê°’ì´ `recoilRoot`ë¡œ ì„¤ì •ë˜ì–´ ìˆê³ , SPA í™˜ê²½ì—ì„œ RecoilRootê°€ ê±°ì˜ ì–¸ë§ˆìš´íŠ¸ë˜ì§€ ì•ŠëŠ” íŠ¹ì„± ë•Œë¬¸ì— ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ê°€ ë°œìƒí•˜ëŠ” ê²ƒì„ í™•ì¸í–ˆìŠµë‹ˆë‹¤.

Recoil íŒ€ì´ ê¸°ë³¸ê°’ì„ 'components'ë¡œ ë³€ê²½í•˜ê² ë‹¤ê³  ì˜ˆê³ í•œ ë§Œí¼ ì¼ì‹œì ì¸ ë¬¸ì œì¼ ìˆ˜ ìˆì§€ë§Œ, í˜„ì¬ Recoilì˜ ìœ ì§€ë³´ìˆ˜ ìƒíƒœ(ë§ˆì§€ë§‰ ë©”ì´ì € ì—…ë°ì´íŠ¸ê°€ 2023ë…„ 4ì›”)ë¥¼ ê³ ë ¤í•  ë•Œ, ì´ ê¸°ë³¸ê°’ ë³€ê²½ì´ ì–¸ì œ ì´ë£¨ì–´ì§ˆì§€ëŠ” ë¶ˆí™•ì‹¤í•©ë‹ˆë‹¤.

ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ëŠ” ì¹˜ëª…ì ì¸ ì´ìŠˆì´ê³ , ë‚´ë¶€ êµ¬í˜„ì„ ë³´ë©´ì„œ ë§ì€ `UNSTABLE` ì„ ëª©ê²©í–ˆê¸° ë•Œë¬¸ì— ì—­ì‹œ `experimental state management library` ë¼ëŠ” ê²ƒì— ê³µê°ì´ ê°”ìŠµë‹ˆë‹¤.

# ì°¸ê³ 
- [Recoil, ì´ì œëŠ” ë– ë‚˜ ë³´ë‚¼ ì‹œê°„ì´ë‹¤](https://medium.com/@clockclcok/recoil-%EC%9D%B4%EC%A0%9C%EB%8A%94-%EB%96%A0%EB%82%98-%EB%B3%B4%EB%82%BC-%EC%8B%9C%EA%B0%84%EC%9D%B4%EB%8B%A4-ff2c8674cdd5)
- [Recoilì˜ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë¬¸ì œ](https://medium.com/@altoo/recoil%EC%9D%98-%EB%A9%94%EB%AA%A8%EB%A6%AC-%EB%88%84%EC%88%98-%EB%AC%B8%EC%A0%9C-fb709973acf2)
-  [Memory leak when using atomFamily/selectorFamily](https://github.com/facebookexperimental/Recoil/issues/366)
- [Recoil Issue: Memory Leak with atomFamily](https://github.com/facebookexperimental/Recoil/issues/314)
-  [SSR - Memory leak](https://github.com/facebookexperimental/Recoil/issues/1864)